# Задание 3. Переход на Event-Driven архитектуру
## Ограничения и предположения
1. Тарифы и характеристики продуктов у страховых компаний меняются очень часто, соответственно кэшировать информацию о продуктах и тарифах на стороне InsureTech нельзя, нужно каждый раз запрашивать информацию у источника.
2. Системы страховых компаний (в т.ч. и будущих) предоставляют только синхронные интерфейсы для получения информации по запросу
3. Т.к. сервис client-info предоставляет API для работы InsureTech Web и это же API используется в работе core-app, то перевод взаимодействия между core-app и client-info в части получения/сохранения информации о клиентах на Event-Streaming подход представляется нецелесообразным. Вопрос об оптимизации получения информации о клиентах можно будет рассмотреть на более поздних стадиях рефакторинга архитектуры приложения

## Потенциальные проблемы, связанные с ростом нагрузки (+5 страховых компаний)
1. ins-product-aggregator не сможет обеспечивать необходимый Response time для метода получения информации по продуктам и тарифам
2. core-app не сможет обеспечивать необходимый Response time для метода получения всех оформленных за день страховок
3. Объем ответа метода core-app для получения всех оформленных за день страховок может кардинально увеличиться, что может привести к обрыву запроса по таймауту; к высокой нагрузке на core-app в момент выполнения запроса; уменьшению пропускной способности сети при выполнении метода

## Предложения по изменению архитектуры
Измененная архитектура представлена на листе "Exc3 - Updated InsureTech"

![](InsureTech_C4_сontainer-diagram-Exc3%20-%20Updated%20InsureTech.drawio.png)
### ins-product-aggregator
1. Перевести процесс получения информации о продуктах и тарифах в асинхронный вид.
   1. Отправитель (core-app, ins-comp-settlement) отправляет запрос на получение информации
   2. Получатель (ins-product-aggregator) сохраняет запрос на получение информации в локальной очереди (паттерн Transactional Outbox), присваивает ему уникальный идентификатор и возвращает идентификатор Отправителю
   3. По расписанию Получатель вычитывает локальную очередь, выявляет необработанные запросы и выполняет паралельно необходимые запросы к системам страховых компаний
   4. Получатель собирает ответы систем страховых компаний в единый ответ и вызывает Callback метода Отправителя

### core-app
1. Перевести процесс получения информации об оформленных заявках с использованием Event-Streaming
   1. Источник (core-app) публикует сообщение о факте оформления страховки в очередь
   2. Получатель (ins-comp-settlement) вычитывает сообщение из очереди